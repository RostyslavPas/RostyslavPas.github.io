<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Strava Authorization Redirect</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        background-color: #0f172a;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        text-align: center;
      }
      h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-top-color: #ff4f00;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      p {
        margin-top: 20px;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <h1>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è Strava‚Ä¶</h1>
    <div class="spinner"></div>
    <p>–ó–∞—á–µ–∫–∞–π, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞–∑–∞–¥ —É –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ üö¥‚Äç‚ôÇÔ∏è</p>

    <script>
      try {
        const params = new URLSearchParams(window.location.search);
        const code = params.get("code");
        const error = params.get("error");

        if (error) {
          document.body.innerHTML = `<h1>‚ùå –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</h1><p>${error}</p>`;
        } else if (code) {
          // –ì–ª–∏–±–æ–∫–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫
          const deepLink = `bikecomponenttracker://redirect?code=${code}`;
          window.location.replace(deepLink);

          // fallback ‚Äî —è–∫—â–æ deep link –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤ –ø—Ä–æ—Ç—è–≥–æ–º 3—Å
          setTimeout(() => {
            window.location.href = `https://rostyslavpas.github.io?code=${code}`;
          }, 3000);
        } else {
          document.body.innerHTML = `<h1>‚ö†Ô∏è –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</h1>`;
        }
      } catch (e) {
        document.body.innerHTML = `<h1>‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ–¥—ñ—Ä–µ–∫—Ç—É</h1><pre>${e.message}</pre>`;
      }
    </script>
  </body>
</html>
