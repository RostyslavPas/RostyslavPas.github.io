<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Cycling Kit Designer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a1a1a;
            color: #fff;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Left Panel - Product Selection */
        .left-panel {
            width: 80px;
            background: #2a2a2a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            border-right: 1px solid #3a3a3a;
        }

        .product-btn {
            width: 60px;
            height: 60px;
            background: #3a3a3a;
            border: 2px solid transparent;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .product-btn:hover {
            border-color: #ffcc00;
            transform: scale(1.05);
        }

        .product-btn.active {
            border-color: #ffcc00;
            background: #4a4a4a;
        }

        .product-btn svg {
            width: 30px;
            height: 30px;
            fill: #fff;
        }

        .product-btn .tooltip {
            position: absolute;
            left: 100%;
            margin-left: 10px;
            background: #333;
            padding: 5px 10px;
            border-radius: 4px;
            white-space: nowrap;
            font-size: 12px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .product-btn:hover .tooltip {
            opacity: 1;
        }

        /* Center - 3D Viewer */
        .viewer-container {
            flex: 1;
            background: #0f0f0f;
            position: relative;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .view-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 8px;
        }

        .view-btn {
            padding: 8px 16px;
            background: #3a3a3a;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn:hover {
            background: #4a4a4a;
        }

        .view-btn.active {
            background: #ffcc00;
            color: #000;
        }

        /* Right Panel - Design Controls */
        .right-panel {
            width: 320px;
            background: #2a2a2a;
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid #3a3a3a;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .color-zone {
            background: #3a3a3a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .zone-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .zone-name {
            font-size: 14px;
            font-weight: 500;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            border: 2px solid #4a4a4a;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .color-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .template-item {
            height: 80px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .template-item:hover {
            border-color: #ffcc00;
            transform: scale(1.05);
        }

        .template-item.active {
            border-color: #ffcc00;
        }

        .template-preview {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .template-color {
            flex: 1;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #ffcc00;
            color: #000;
        }

        .btn-primary:hover {
            background: #e6b800;
        }

        .btn-secondary {
            background: #3a3a3a;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #4a4a4a;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #3a3a3a;
            border-top-color: #ffcc00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .divider {
            height: 1px;
            background: #3a3a3a;
            margin: 20px 0;
        }

        .slider-container {
            margin-top: 10px;
        }

        .slider-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }

        .slider {
            width: 100%;
            height: 6px;
            background: #3a3a3a;
            border-radius: 3px;
            -webkit-appearance: none;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #ffcc00;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #ffcc00;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel - Product Selection -->
        <div class="left-panel">
            <button class="product-btn active" data-product="jersey-short">
                <svg viewBox="0 0 24 24">
                    <path d="M16,21H8a1,1,0,0,1-1-1V16.92L5.5,14.62A1,1,0,0,1,5,13.85V8.15a1,1,0,0,1,.5-.77L7,5.08V3a1,1,0,0,1,1-1h8a1,1,0,0,1,1,1V5.08l1.5,2.3a1,1,0,0,1,.5.77v5.7a1,1,0,0,1-.5.77L17,16.92V20A1,1,0,0,1,16,21Z"/>
                </svg>
                <span class="tooltip">Джерсі короткий рукав</span>
            </button>
            <button class="product-btn" data-product="jersey-long">
                <svg viewBox="0 0 24 24">
                    <path d="M20,21H18V16.92l1.5-2.3a1,1,0,0,0,.5-.77V8.15a1,1,0,0,0-.5-.77L16,3V2a1,1,0,0,0-1-1H9A1,1,0,0,0,8,2V3L4.5,7.38a1,1,0,0,0-.5.77v5.7a1,1,0,0,0,.5.77L6,16.92V21H4a1,1,0,0,0,0,2H20a1,1,0,0,0,0-2Z"/>
                </svg>
                <span class="tooltip">Джерсі довгий рукав</span>
            </button>
            <button class="product-btn" data-product="bibs">
                <svg viewBox="0 0 24 24">
                    <path d="M19,21H16V13H8v8H5a1,1,0,0,1-1-1V10a1,1,0,0,1,.5-.87L12,5l7.5,4.13A1,1,0,0,1,20,10V20A1,1,0,0,1,19,21Z"/>
                </svg>
                <span class="tooltip">Велошорти</span>
            </button>
            <button class="product-btn" data-product="vest">
                <svg viewBox="0 0 24 24">
                    <path d="M16,21H8a1,1,0,0,1-1-1V14L5.5,11.5A1,1,0,0,1,5,10.71V7.29a1,1,0,0,1,.5-.79L8,4V3a1,1,0,0,1,1-1h6a1,1,0,0,1,1,1V4l2.5,2.5a1,1,0,0,1,.5.79v3.42a1,1,0,0,1-.5.79L17,14v6A1,1,0,0,1,16,21Z"/>
                </svg>
                <span class="tooltip">Жилетка</span>
            </button>
            <button class="product-btn" data-product="socks">
                <svg viewBox="0 0 24 24">
                    <path d="M18,14v6a2,2,0,0,1-2,2H10a2,2,0,0,1-2-2V14a2,2,0,0,1,2-2h6A2,2,0,0,1,18,14ZM16,2H10A2,2,0,0,0,8,4v6h10V4A2,2,0,0,0,16,2Z"/>
                </svg>
                <span class="tooltip">Шкарпетки</span>
            </button>
        </div>

        <!-- Center - 3D Viewer -->
        <div class="viewer-container">
            <div id="canvas-container"></div>
            <div class="loading-overlay" id="loading">
                <div class="loading-spinner"></div>
            </div>
            <div class="view-controls">
                <button class="view-btn active" data-view="front">Спереду</button>
                <button class="view-btn" data-view="back">Ззаду</button>
                <button class="view-btn" data-view="side">Збоку</button>
                <button class="view-btn" data-view="rotate">Обертати</button>
            </div>
        </div>

        <!-- Right Panel - Design Controls -->
        <div class="right-panel">
            <div class="section">
                <h3 class="section-title">Кольорові зони</h3>
                <div id="color-zones"></div>
            </div>

            <div class="divider"></div>

            <div class="section">
                <h3 class="section-title">Шаблони</h3>
                <div class="template-grid" id="templates"></div>
            </div>

            <div class="divider"></div>

            <div class="section">
                <h3 class="section-title">Налаштування</h3>
                <div class="slider-container">
                    <div class="slider-label">Яскравість матеріалу</div>
                    <input type="range" class="slider" id="brightness" min="0.5" max="1.5" step="0.1" value="1">
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetDesign()">Скинути</button>
                <button class="btn btn-primary" onclick="saveDesign()">Зберегти</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, model, controls;
        let currentProduct = 'jersey-short';
        let isRotating = false;
        let mouse = { x: 0, y: 0 };
        let mouseDown = false;
        let rotationSpeed = 0.005;

        // Product configurations
        const products = {
            'jersey-short': {
                name: 'Джерсі короткий рукав',
                zones: [
                    { id: 'main', name: 'Основний колір', color: '#FFEB3B' },
                    { id: 'sides', name: 'Бокові вставки', color: '#FFC107' },
                    { id: 'sleeves', name: 'Рукави', color: '#FFEB3B' },
                    { id: 'collar', name: 'Комір', color: '#333333' },
                    { id: 'cuffs', name: 'Манжети', color: '#333333' }
                ]
            },
            'jersey-long': {
                name: 'Джерсі довгий рукав',
                zones: [
                    { id: 'main', name: 'Основний колір', color: '#FFEB3B' },
                    { id: 'sides', name: 'Бокові вставки', color: '#FFC107' },
                    { id: 'sleeves', name: 'Рукави', color: '#FFEB3B' },
                    { id: 'collar', name: 'Комір', color: '#333333' },
                    { id: 'cuffs', name: 'Манжети', color: '#333333' }
                ]
            },
            'bibs': {
                name: 'Велошорти',
                zones: [
                    { id: 'main', name: 'Основний колір', color: '#000000' },
                    { id: 'straps', name: 'Лямки', color: '#000000' },
                    { id: 'sides', name: 'Бокові вставки', color: '#FFC107' },
                    { id: 'gripper', name: 'Гумка', color: '#333333' }
                ]
            },
            'vest': {
                name: 'Жилетка',
                zones: [
                    { id: 'main', name: 'Основний колір', color: '#FFEB3B' },
                    { id: 'sides', name: 'Бокові вставки', color: '#FFC107' },
                    { id: 'collar', name: 'Комір', color: '#333333' },
                    { id: 'zipper', name: 'Блискавка', color: '#FFFFFF' }
                ]
            },
            'socks': {
                name: 'Шкарпетки',
                zones: [
                    { id: 'main', name: 'Основний колір', color: '#FFEB3B' },
                    { id: 'cuff', name: 'Манжета', color: '#333333' },
                    { id: 'heel', name: "П'ятка", color: '#FFFFFF' },
                    { id: 'toe', name: 'Носок', color: '#FFFFFF' }
                ]
            }
        };

        // Color templates
        const colorTemplates = [
            { name: 'BFCC Yellow', colors: ['#FFEB3B', '#FFC107', '#333333'] },
            { name: 'Sky Blue', colors: ['#03A9F4', '#0288D1', '#FFFFFF'] },
            { name: 'Fire Red', colors: ['#F44336', '#D32F2F', '#212121'] },
            { name: 'Forest Green', colors: ['#4CAF50', '#388E3C', '#1B5E20'] },
            { name: 'Midnight', colors: ['#1A237E', '#000051', '#FFD600'] },
            { name: 'Sunset', colors: ['#FF6F00', '#E65100', '#FFD54F'] },
            { name: 'Ocean', colors: ['#006064', '#00838F', '#B2EBF2'] },
            { name: 'Carbon', colors: ['#263238', '#000000', '#FF6F00'] },
            { name: 'Pink Power', colors: ['#E91E63', '#C2185B', '#F8BBD0'] }
        ];

        // Initialize Three.js
        function initThreeJS() {
            const container = document.getElementById('canvas-container');

            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f0f0f);

            // Camera
            camera = new THREE.PerspectiveCamera(
                45,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(0, 0, 5);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 5, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.camera.near = 0.1;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -10;
            directionalLight.shadow.camera.right = 10;
            directionalLight.shadow.camera.top = 10;
            directionalLight.shadow.camera.bottom = -10;
            scene.add(directionalLight);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-5, 3, -5);
            scene.add(directionalLight2);

            // Load initial model
            loadModel(currentProduct);

            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);

            // Mouse controls
            container.addEventListener('mousedown', onMouseDown, false);
            container.addEventListener('mousemove', onMouseMove, false);
            container.addEventListener('mouseup', onMouseUp, false);
            container.addEventListener('wheel', onMouseWheel, false);

            // Start animation loop
            animate();
        }

        // Create 3D model based on product type
        function createProductGeometry(productType) {
            const geometries = {};

            switch(productType) {
                case 'jersey-short':
                case 'jersey-long':
                    // Body
                    const bodyGeometry = new THREE.CylinderGeometry(1, 1.2, 2.5, 32);
                    geometries.main = new THREE.Mesh(
                        bodyGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFEB3B })
                    );

                    // Sleeves
                    const sleeveLength = productType === 'jersey-long' ? 1.5 : 0.5;
                    const sleeveGeometry = new THREE.CylinderGeometry(0.3, 0.4, sleeveLength, 16);

                    geometries.sleeves = new THREE.Group();
                    const leftSleeve = new THREE.Mesh(
                        sleeveGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFEB3B })
                    );
                    leftSleeve.rotation.z = -Math.PI / 4;
                    leftSleeve.position.set(-1.2, 0.8, 0);

                    const rightSleeve = new THREE.Mesh(
                        sleeveGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFEB3B })
                    );
                    rightSleeve.rotation.z = Math.PI / 4;
                    rightSleeve.position.set(1.2, 0.8, 0);

                    geometries.sleeves.add(leftSleeve);
                    geometries.sleeves.add(rightSleeve);

                    // Collar
                    const collarGeometry = new THREE.TorusGeometry(0.5, 0.1, 8, 16);
                    geometries.collar = new THREE.Mesh(
                        collarGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x333333 })
                    );
                    geometries.collar.position.y = 1.25;
                    geometries.collar.rotation.x = Math.PI / 2;

                    // Side panels
                    const sideGeometry = new THREE.BoxGeometry(0.3, 2.3, 1.4);
                    geometries.sides = new THREE.Group();

                    const leftSide = new THREE.Mesh(
                        sideGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFC107 })
                    );
                    leftSide.position.set(-1.05, 0, 0);

                    const rightSide = new THREE.Mesh(
                        sideGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFC107 })
                    );
                    rightSide.position.set(1.05, 0, 0);

                    geometries.sides.add(leftSide);
                    geometries.sides.add(rightSide);
                    break;

                case 'bibs':
                    // Shorts
                    const shortsGeometry = new THREE.CylinderGeometry(0.8, 1.2, 1.5, 24);
                    geometries.main = new THREE.Mesh(
                        shortsGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x000000 })
                    );
                    geometries.main.position.y = -0.5;

                    // Straps
                    geometries.straps = new THREE.Group();
                    const strapGeometry = new THREE.BoxGeometry(0.2, 3, 0.1);

                    const frontStrapLeft = new THREE.Mesh(
                        strapGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x000000 })
                    );
                    frontStrapLeft.position.set(-0.4, 1, 0.5);

                    const frontStrapRight = new THREE.Mesh(
                        strapGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x000000 })
                    );
                    frontStrapRight.position.set(0.4, 1, 0.5);

                    const backStrapLeft = new THREE.Mesh(
                        strapGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x000000 })
                    );
                    backStrapLeft.position.set(-0.4, 1, -0.5);

                    const backStrapRight = new THREE.Mesh(
                        strapGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x000000 })
                    );
                    backStrapRight.position.set(0.4, 1, -0.5);

                    geometries.straps.add(frontStrapLeft);
                    geometries.straps.add(frontStrapRight);
                    geometries.straps.add(backStrapLeft);
                    geometries.straps.add(backStrapRight);

                    // Side panels
                    const bibSideGeometry = new THREE.BoxGeometry(0.2, 1.3, 0.9);
                    geometries.sides = new THREE.Group();

                    const bibLeftSide = new THREE.Mesh(
                        bibSideGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFC107 })
                    );
                    bibLeftSide.position.set(-0.95, -0.5, 0);

                    const bibRightSide = new THREE.Mesh(
                        bibSideGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFC107 })
                    );
                    bibRightSide.position.set(0.95, -0.5, 0);

                    geometries.sides.add(bibLeftSide);
                    geometries.sides.add(bibRightSide);
                    break;

                case 'vest':
                    // Body
                    const vestBodyGeometry = new THREE.CylinderGeometry(1, 1.2, 2.2, 32, 1, true, 0, Math.PI * 1.8);
                    geometries.main = new THREE.Mesh(
                        vestBodyGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFEB3B, side: THREE.DoubleSide })
                    );

                    // Collar
                    const vestCollarGeometry = new THREE.TorusGeometry(0.6, 0.12, 8, 16, Math.PI * 1.5);
                    geometries.collar = new THREE.Mesh(
                        vestCollarGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x333333 })
                    );
                    geometries.collar.position.y = 1.1;
                    geometries.collar.rotation.x = Math.PI / 2;

                    // Zipper
                    const zipperGeometry = new THREE.BoxGeometry(0.1, 2, 0.05);
                    geometries.zipper = new THREE.Mesh(
                        zipperGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFFFFF })
                    );
                    geometries.zipper.position.set(0, 0, 1.15);
                    break;

                case 'socks':
                    // Main sock body
                    const sockGeometry = new THREE.CylinderGeometry(0.3, 0.35, 1.5, 16);
                    geometries.main = new THREE.Mesh(
                        sockGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFEB3B })
                    );

                    // Cuff
                    const cuffGeometry = new THREE.CylinderGeometry(0.32, 0.3, 0.3, 16);
                    geometries.cuff = new THREE.Mesh(
                        cuffGeometry,
                        new THREE.MeshPhongMaterial({ color: 0x333333 })
                    );
                    geometries.cuff.position.y = 0.9;

                    // Heel
                    const heelGeometry = new THREE.SphereGeometry(0.35, 16, 16, 0, Math.PI, 0, Math.PI);
                    geometries.heel = new THREE.Mesh(
                        heelGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFFFFF })
                    );
                    geometries.heel.position.set(0, -0.6, -0.2);
                    geometries.heel.rotation.y = Math.PI / 2;

                    // Toe
                    const toeGeometry = new THREE.SphereGeometry(0.35, 16, 16, 0, Math.PI, 0, Math.PI);
                    geometries.toe = new THREE.Mesh(
                        toeGeometry,
                        new THREE.MeshPhongMaterial({ color: 0xFFFFFF })
                    );
                    geometries.toe.position.set(0, -0.75, 0.3);
                    geometries.toe.rotation.y = -Math.PI / 2;
                    geometries.toe.rotation.z = Math.PI / 8;
                    break;
            }

            return geometries;
        }

        // Load 3D model
        function loadModel(productType) {
            // Show loading
            document.getElementById('loading').style.display = 'flex';

            // Clear existing model
            if (model) {
                scene.remove(model);
            }

            // Create new model group
            model = new THREE.Group();

            // Get geometries for the product
            const geometries = createProductGeometry(productType);

            // Add all parts to the model
            Object.values(geometries).forEach(part => {
                model.add(part);
            });

            // Store references to parts for color updates
            model.userData.parts = geometries;

            // Add model to scene
            scene.add(model);

            // Update UI
            updateColorZones(productType);
            updateTemplates();

            // Hide loading
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 500);
        }

        // Update color zones UI
        function updateColorZones(productType) {
            const zonesContainer = document.getElementById('color-zones');
            zonesContainer.innerHTML = '';

            const product = products[productType];

            product.zones.forEach(zone => {
                const zoneEl = document.createElement('div');
                zoneEl.className = 'color-zone';
                zoneEl.innerHTML = `
                    <div class="zone-header">
                        <span class="zone-name">${zone.name}</span>
                        <div class="color-preview" style="background-color: ${zone.color}">
                            <input type="color" class="color-input" value="${zone.color}"
                                   data-zone="${zone.id}" onchange="updateZoneColor(this)">
                        </div>
                    </div>
                `;
                zonesContainer.appendChild(zoneEl);
            });
        }

        // Update zone color
        function updateZoneColor(input) {
            const zoneId = input.dataset.zone;
            const color = input.value;

            // Update product configuration
            products[currentProduct].zones.find(z => z.id === zoneId).color = color;

            // Update 3D model
            if (model && model.userData.parts[zoneId]) {
                const part = model.userData.parts[zoneId];
                if (part.material) {
                    part.material.color.setStyle(color);
                } else if (part.children) {
                    part.children.forEach(child => {
                        if (child.material) {
                            child.material.color.setStyle(color);
                        }
                    });
                }
            }
        }

        // Update templates
        function updateTemplates() {
            const templatesContainer = document.getElementById('templates');
            templatesContainer.innerHTML = '';

            colorTemplates.forEach((template, index) => {
                const templateEl = document.createElement('div');
                templateEl.className = 'template-item';
                templateEl.onclick = () => applyTemplate(template);

                const preview = document.createElement('div');
                preview.className = 'template-preview';

                template.colors.forEach(color => {
                    const colorDiv = document.createElement('div');
                    colorDiv.className = 'template-color';
                    colorDiv.style.backgroundColor = color;
                    preview.appendChild(colorDiv);
                });

                templateEl.appendChild(preview);
                templatesContainer.appendChild(templateEl);
            });
        }

        // Apply color template
        function applyTemplate(template) {
            const product = products[currentProduct];

            // Apply colors to zones
            template.colors.forEach((color, index) => {
                if (index < product.zones.length) {
                    product.zones[index].color = color;

                    // Update UI
                    const colorInput = document.querySelector(`input[data-zone="${product.zones[index].id}"]`);
                    if (colorInput) {
                        colorInput.value = color;
                        colorInput.parentElement.style.backgroundColor = color;
                    }

                    // Update 3D model
                    if (model && model.userData.parts[product.zones[index].id]) {
                        const part = model.userData.parts[product.zones[index].id];
                        if (part.material) {
                            part.material.color.setStyle(color);
                        } else if (part.children) {
                            part.children.forEach(child => {
                                if (child.material) {
                                    child.material.color.setStyle(color);
                                }
                            });
                        }
                    }
                }
            });
        }

        // Mouse controls
        function onMouseDown(event) {
            mouseDown = true;
            mouse.x = event.clientX;
            mouse.y = event.clientY;
        }

        function onMouseMove(event) {
            if (!mouseDown || isRotating) return;

            const deltaX = event.clientX - mouse.x;
            const deltaY = event.clientY - mouse.y;

            if (model) {
                model.rotation.y += deltaX * 0.01;
                model.rotation.x += deltaY * 0.01;
            }

            mouse.x = event.clientX;
            mouse.y = event.clientY;
        }

        function onMouseUp() {
            mouseDown = false;
        }

        function onMouseWheel(event) {
            event.preventDefault();
            camera.position.z += event.deltaY * 0.01;
            camera.position.z = Math.max(2, Math.min(10, camera.position.z));
        }

        // Window resize
        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            if (isRotating && model) {
                model.rotation.y += rotationSpeed;
            }

            renderer.render(scene, camera);
        }

        // View controls
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const view = this.dataset.view;
                isRotating = false;

                if (model) {
                    switch(view) {
                        case 'front':
                            model.rotation.set(0, 0, 0);
                            break;
                        case 'back':
                            model.rotation.set(0, Math.PI, 0);
                            break;
                        case 'side':
                            model.rotation.set(0, Math.PI / 2, 0);
                            break;
                        case 'rotate':
                            isRotating = true;
                            break;
                    }
                }
            });
        });

        // Product selection
        document.querySelectorAll('.product-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.product-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentProduct = this.dataset.product;
                loadModel(currentProduct);
            });
        });

        // Brightness control
        document.getElementById('brightness').addEventListener('input', function() {
            const brightness = parseFloat(this.value);
            if (model) {
                model.traverse(child => {
                    if (child.isMesh && child.material) {
                        child.material.emissiveIntensity = brightness - 1;
                        child.material.emissive = new THREE.Color(0x111111);
                    }
                });
            }
        });

        // Reset design
        function resetDesign() {
            const defaultProduct = {
                'jersey-short': ['#FFEB3B', '#FFC107', '#FFEB3B', '#333333', '#333333'],
                'jersey-long': ['#FFEB3B', '#FFC107', '#FFEB3B', '#333333', '#333333'],
                'bibs': ['#000000', '#000000', '#FFC107', '#333333'],
                'vest': ['#FFEB3B', '#FFC107', '#333333', '#FFFFFF'],
                'socks': ['#FFEB3B', '#333333', '#FFFFFF', '#FFFFFF']
            };

            const template = {
                colors: defaultProduct[currentProduct]
            };

            applyTemplate(template);
        }

        // Save design
        function saveDesign() {
            // Create canvas from renderer
            const canvas = renderer.domElement;
            const dataURL = canvas.toDataURL('image/png');

            // Create download link
            const link = document.createElement('a');
            link.download = `${currentProduct}_design_${Date.now()}.png`;
            link.href = dataURL;
            link.click();

            // Show success message
            alert('Дизайн збережено!');
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initThreeJS();
        });
    </script>
</body>
</html>